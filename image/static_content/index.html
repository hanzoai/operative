<!doctype html>
<html>
    <head>
        <title>Hanzo Operative</title>
        <meta name="permissions-policy" content="fullscreen=*" />
        <style>
            body {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            .container {
                display: flex;
                height: 100vh;
                width: 100vw;
            }
            .left {
                flex: 1;
                border: none;
                height: 100vh;
            }
            .right {
                flex: 2;
                border: none;
                height: 100vh;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <iframe id="app" class="left" allow="fullscreen"></iframe>
            <iframe
                id="vnc"
                class="right"
                allow="fullscreen"
            ></iframe>
            <button
                id="toggleViewOnly"
                style="position: absolute; top: 10px; right: 10px; z-index: 1000"
            >
                Toggle Screen Control (Off)
            </button>
        </div>
        <script>
            // Set endpoint URLs based on host.
            const isLocal = ['localhost', '127.0.0.1'].includes(window.location.hostname);
            
            // Fetch environment variables from server
            fetch('/env-config.json')
                .then(response => response.json())
                .then(envConfig => {
                    // Use environment variables or fallback to defaults
                    const appEndpoint = envConfig.APP_ENDPOINT || 'operative-app.hanzo.ai';
                    const vncEndpoint = envConfig.VNC_ENDPOINT || 'operative-vnc.hanzo.ai';
                    
                    const appUrl = isLocal
                        ? 'http://localhost:8501'
                        : `https://${appEndpoint}`;
                    const vncUrl = isLocal
                        ? 'http://localhost:6080/vnc.html?resize=scale&autoconnect=1&view_only=1&reconnect=1&reconnect_delay=2000'
                        : `https://${vncEndpoint}/vnc.html?resize=scale&autoconnect=1&view_only=1&reconnect=1&reconnect_delay=2000`;

                    // Set the iframe sources.
                    document.getElementById('app').src = appUrl;
                    document.getElementById('vnc').src = vncUrl;
                })
                .catch(error => {
                    console.error('Failed to fetch environment config:', error);
                    
                    // Fallback to default endpoints
                    const appEndpoint = 'operative-app.hanzo.ai';
                    const vncEndpoint = 'operative-vnc.hanzo.ai';
                    
                    const appUrl = isLocal
                        ? 'http://localhost:8501'
                        : `https://${appEndpoint}`;
                    const vncUrl = isLocal
                        ? 'http://localhost:6080/vnc.html?resize=scale&autoconnect=1&view_only=1&reconnect=1&reconnect_delay=2000'
                        : `https://${vncEndpoint}/vnc.html?resize=scale&autoconnect=1&view_only=1&reconnect=1&reconnect_delay=2000`;

                    // Set the iframe sources.
                    document.getElementById('app').src = appUrl;
                    document.getElementById('vnc').src = vncUrl;
                });

            // Toggle view_only parameter in VNC iframe.
            document.getElementById("toggleViewOnly").addEventListener("click", function () {
                var vncIframe = document.getElementById("vnc");
                var button = document.getElementById("toggleViewOnly");
                var currentSrc = vncIframe.src;
                if (currentSrc.includes("view_only=1")) {
                    vncIframe.src = currentSrc.replace("view_only=1", "view_only=0");
                    button.innerText = "Toggle Screen Control (On)";
                } else {
                    vncIframe.src = currentSrc.replace("view_only=0", "view_only=1");
                    button.innerText = "Toggle Screen Control (Off)";
                }
            });
        </script>
    </body>
</html>
